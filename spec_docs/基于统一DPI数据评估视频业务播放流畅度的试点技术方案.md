# 基于统一DPI数据评估视频业务播放流畅度的试点技术方案
**维护优化处 2016年8月**
##1. 概述
统一DPI使得面向业务、面向终端的网络及业务质量分析成为可能。目前对视频业务播放流畅程度的评估指标主要包括“视频下载平均速率、视频播放平均停顿次数”。对于视频下载平均速率，由于视频播放存在缓存机制，单纯依靠下载速率无法准确反映用户的实际感受。对于视频播放平均停顿次数，由于难以对视频的播放码率进行准确的测量，因此统计的平均停顿次数和用户实际感受到的次数也存在较大偏差，该指标仅能从大的趋势上做近似评估。

视频业务是移动互联网时代用户使用的最多的几类业务之一，而播放流畅度对用户的业务体验影响最大，因此非常有必要对视频播放的流畅度做更为精准的评估，而且评估的结果要更加贴近用户的实际感受。

总部组织部分省、设计院开展了专题研究，确定了几个技术方案并设计了相应的指标，拟于本次试点进行验证。

##2. 关于试点期间的规范基线说明
所有指标及xDR的修订均基于规范基线版本开展。

| **序号**    | **规范基线**                 |
| --------- | ------------------------ |
| DPI xDR定义 | 《中国移动统一DPI设备规范20160419》  |
| KQI指标定义   | 《LTE信令监测及互联网KQI指标规范v2.0》 |

*表格 1 规范基线*

## 3. 关于试点期间的规范基线说明

### 3.1 试点内容

1. **指标范围**

   ```
   说明：按DPI基线规范要求，视频xDR是基于单请求Get粒度来生成的，因此#3，#9～#12指标的实施需要基于单Get xDR来合成一个完整视频的xDR，具体的合成算法超出了试点的范围，由各厂商自行研究。
   ```

   | 序号   | 类别   | 指标名称          | 修订情况 |
   | ---- | ---- | ------------- | ---- |
   | 1    | 类别1  | 视频播放流畅度       | 新增   |
   | 2    | 类别1  | HLS视频播放卡顿TS占比 | 新增   |
   | 3    | 类别1  | 视频可观看时长占比     | 新增   |
   | 4    | 类别2  | 视频单请求下载成功率    | 新增   |
   | 5    | 类别2  | 视频单请求首次缓冲成功率  | 新增   |
   | 6    | 类别2  | 视频单请求首次缓冲时长   | 新增   |
   | 7    | 类别2  | 视频单请求下载平均速率   | 新增   |
   | 8    | 类别2  | 视频单请求播放平均卡顿间隔 | 新增   |
   | 9    | 类别3  | 合成视频播放成功率     | 修订   |
   | 10   | 类别3  | 合成视频下载平均速率    | 修订   |
   | 11   | 类别3  | 合成视频播放等待时长    | 修订   |
   | 12   | 类别3  | 合成视频播放平均卡顿间隔  | 新增   |
   | 13   | 类别3  | 视频播放平均停顿次数    | 删除   |
   | 14   | 类别4  | 视频首帧时延        | 新增   |
   | 15   | 类别4  | 视频播放卡顿次数      | 新增   |
   | 16   | 类别4  | 视频播放卡顿时长占比    | 新增   |

2. **指标的IT化实现**
   在本省基于DPI的生产应用系统中，实现并生成表格2中的指标。本次试点范围包括4类指标：

   **类别1**：新设计的用于评估视频播放流畅程度的指标。

   **类别2**：由于DPI基线版要求xDR是基于单个事务生成，而指标集基线版中的视频类指标都是基于合成为完整视频的xDR来计算。为了适应新版DPI规范，参照基线版的“播放成功率、下载平均速率、平均停顿次数”，新引入了基于单请求xDR的算法，并设计了5个新指标。（详细指标定义见第4章）

   **类别3**：基于合成xDR算法的原有4个指标（播放成功率、下载平均速率、平均停顿次数、播放等待时长）仍然保留，但是更新了xDR字段的映射算法。

   **类别4**：新设计的基于解析客户端和服务器交互信息的3个指标（首帧时延、卡顿次数、卡顿时长占比），通过挖掘HTTP  XDR话单中HOST、URI字段中包含的视频质量信息进行关联分析。
   IT化实现必然涉及到指标的检索、分析等软件功能，这些软件功能由各省自行确定。

3. **研究合成视频xDR的算法**
   对于选择第三类指标做试点的省，可以进一步研究如何从单会话的xDR合成为一个完整视频的xDR的算法。

4. **对视频播放流程度做专项分析**

   完成指标的IT化实现后，需要在试点地市做视频业务质量专项分析，以评估这些新增或修订指标用于视频业务质量分析（特别是流畅度分析）的合理性、有效性、准确性。

   涵盖的应用APP至少要包含“腾讯视频、优酷视频、爱奇艺、搜狐视频、乐视、新浪视频、芒果TV、土豆网、PPLive、CNTV、咪咕视频”。

5. **提出指标的修订建议并总结新的需求**
   总结试点过程中发现的指标设计问题，并提出改进方案。总结试点过程中发现的新需求和新思路。
###3.2 试点范围及各环节调研情况
根据向各省调研的情况，确定下述试点的范围和各环节开发单位信息。

| **省名** | **试点地市** | **DPI应用系统分层情况（采集层、共享层、应用层）** |
| ------ | -------- | ---------------------------- |
| 天津     | 天津全境     | 博瑞德、博瑞德/浪潮、博瑞德               |
| 山西     | 太原、大同    | 中创、华为、浪潮                     |
| 浙江     | 杭州、温州    | 华为、华为、华为                     |
| 福建     | 福州、厦门    | 华为、华为、诺基亚                    |
| 广西     | 南宁、柳州    | 华为、华为/亿阳、浪潮/中兴               |
| 四川     | 四川全境     | 浩瀚/爱立信、浩瀚、九鼎瑞信               |

### 3.3 时间计划

1. **试点周期**

* 第一类指标：2016年10月底前完成；
* 第二类指标：2016年11月底前完成；
* 第三类指标：2016年11月底前完成；
2. **技术沟通会：每月上旬定期召开**
##4.指标定义
###4.1 视频单请求下载成功率
1. 指标名称：视频单请求下载成功率
2. 英文名称：Service.Video.PerReq.SuccRate
3. 业务需求：评估视频单次请求下载成功的占比情况。
4. 指标定义：统计时间段内视频播请求下载成功比例。
5. 指标算法：∑（视频单请求下载完成次数/视频请求总次数）/N×100%
   1. 视频单请求：一个视频文件，根据不同网站的播放模型，可能分成多个会话和get请求，每一个会话或get请求被称为视频单请求。基于视频单请求的指标，在大部分情况下与基于合成视频的指标能达到相近的评估效果。
6. 映射关系：
   1. 视频请求总次数：视频业务XDR的总个数。
   2. 单请求下载完成次数：HTTPXDR中字段“App Type”=5的条目里，“Service Comp Flag” 字段=3的XDR个数。
7. 数据类型: 实型
8. 数据单位：无
9. 空间粒度：终端/小区/TAC/SGW /网站
10. 时间粒度：15分钟
11. 数据来源：S1-U/S11 

###4.2 视频单请求首次缓冲成功率
1. 指标名称：视频单请求首次缓冲成功率
2. 英文名称：Service.Video.PerReq.FirstBufferSuccRate
3. 业务需求：评估视频资源下载阶段“最小缓冲要求”成功完成的占比情况。
4. 指标定义：统计时间段内单次视频请求满足“最小缓冲要求”的成功缓冲比例。
5. 指标算法：∑（视频缓冲成功总次数）/∑（视频请求总次数）×100%
    1. 视频请求次数：成功解析出视频码率视频资源请求次数。
    2. 视频缓冲成功次数：成功完成视频初始缓存的资源请求次数。
6. 映射关系：
    1. 视频请求次数：XDR 字段“App Type”=5，且视频业务XDR中“Streaming-Rate”字段值大于零的记录个数。（对于单独生成的Video XDR，该字段均为5）
    2. 视频缓冲成功次数：XDR 字段“App Type”=5，且统计视频业务XDR中Play-Success字段为1的XDR记录数。
7. 数据类型: 实型
8. 数据单位：无
9. 空间粒度：终端/小区/TAC/SGW /网站
10. 时间粒度：15分钟
11. 数据来源：S1-U/S11

